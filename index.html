<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Workout Tracker">
    <meta name="theme-color" content="#667eea">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23667eea' width='100' height='100'/><text y='75' font-size='70' text-anchor='middle' x='50'>üí™</text></svg>">
    <link rel="manifest" href="manifest.json">
    <title>Posture & Strength Program</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            padding: 40px;
            color: white;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 300;
        }

        .main-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .workout-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .workout-btn {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .workout-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .workout-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #22c55e);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.95em;
            opacity: 0.9;
        }

        .exercise-card {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 25px;
            padding: 35px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 25px;
        }

        .exercise-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .edit-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .edit-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .edit-btn.active {
            background: rgba(74, 222, 128, 0.3);
            border-color: #4ade80;
        }

        .exercise-name {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .exercise-meta {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            opacity: 0.9;
        }

        .meta-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .weight-input-container {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
        }

        .exercise-image {
            width: 100%;
            height: 400px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-gallery {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .gallery-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }

        .gallery-image.active {
            display: block;
        }

        .placeholder-icon {
            font-size: 4em;
            opacity: 0.4;
        }

        .gallery-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.3em;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .gallery-arrow:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .gallery-arrow.left {
            left: 15px;
        }

        .gallery-arrow.right {
            right: 15px;
        }

        .gallery-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .image-counter {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            z-index: 10;
        }

        .upload-zone {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .upload-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px dashed rgba(255, 255, 255, 0.4);
            padding: 15px 30px;
            border-radius: 15px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .thumbnail-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .thumbnail-wrapper {
            position: relative;
        }

        .image-thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .image-thumbnail:hover {
            border-color: #4ade80;
            transform: scale(1.05);
        }

        .image-thumbnail.active {
            border-color: #4ade80;
        }

        .delete-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(248, 113, 113, 0.9);
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .thumbnail-wrapper:hover .delete-image-btn {
            opacity: 1;
        }

        .exercise-details {
            margin-bottom: 25px;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-content {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 12px;
            line-height: 1.6;
        }

        .editable-input {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px;
            border-radius: 10px;
            font-size: 1em;
            width: 100%;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .editable-input:focus {
            outline: none;
            border-color: #4ade80;
            background: rgba(255, 255, 255, 0.2);
        }

        textarea.editable-input {
            min-height: 80px;
            resize: vertical;
        }

        .steps-list {
            list-style: none;
        }

        .steps-list li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .steps-list li:before {
            content: attr(data-step);
            position: absolute;
            left: 0;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 600;
        }

        .cues-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .cue-box {
            padding: 12px;
            border-radius: 10px;
            font-size: 0.95em;
        }

        .focus-cue {
            background: rgba(74, 222, 128, 0.2);
            border-left: 3px solid #4ade80;
        }

        .avoid-cue {
            background: rgba(248, 113, 113, 0.2);
            border-left: 3px solid #f87171;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .control-btn {
            padding: 18px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-prev {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-prev:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .btn-next {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.3);
        }

        .btn-next:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 222, 128, 0.4);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .completion-card {
            text-align: center;
            padding: 50px 30px;
        }

        .completion-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .completion-card h2 {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .completion-card p {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .bento-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .bento-item {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .bento-large {
            grid-column: span 2;
            grid-row: span 2;
        }

        .bento-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.95em;
        }

        .stat-change {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 10px;
        }

        .stat-up {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .stat-down {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 0.95em;
            cursor: pointer;
            flex: 1;
            min-width: 150px;
        }

        .filter-select option {
            background: #667eea;
            color: white;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .recent-workouts {
            max-height: 300px;
            overflow-y: auto;
        }

        .workout-entry {
            background: rgba(255, 255, 255, 0.08);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workout-date {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .workout-name {
            font-weight: 600;
        }

        .editable-list {
            list-style: none;
        }

        .editable-list-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .remove-btn, .add-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: rgba(248, 113, 113, 0.3);
            border-color: #f87171;
        }

        .add-btn {
            width: 100%;
            margin-top: 10px;
        }

        .add-btn:hover {
            background: rgba(74, 222, 128, 0.3);
            border-color: #4ade80;
        }

        @media (max-width: 1024px) {
            .bento-grid {
                grid-template-columns: 1fr;
            }

            .bento-large {
                grid-column: span 1;
                grid-row: span 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .exercise-name {
                font-size: 1.5em;
            }

            .cues-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .control-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí™ Posture & Strength</h1>
            <p>Dion's Training Program</p>
        </div>

        <div class="main-nav">
            <button class="nav-btn active" onclick="showSection('workout')">üèãÔ∏è Workout</button>
            <button class="nav-btn" onclick="showSection('dashboard')">üìä Dashboard</button>
        </div>

        <!-- Workout Section -->
        <div id="workoutSection">
            <div class="workout-selector" id="workoutSelector">
                <button class="workout-btn" data-workout="posterior">Sunday - Posterior</button>
                <button class="workout-btn" data-workout="fullbody">Tuesday - Full Body</button>
                <button class="workout-btn" data-workout="anterior">Friday - Anterior</button>
            </div>

            <div id="workoutContent" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText"></div>
                </div>

                <div class="exercise-card" id="exerciseCard"></div>

                <div class="controls">
                    <button class="control-btn btn-prev" id="prevBtn">‚Üê Previous</button>
                    <button class="control-btn btn-next" id="nextBtn">Next ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="dashboard">
            <div class="filter-controls">
                <select class="filter-select" id="exerciseFilter" onchange="updateDashboard()">
                    <option value="">Select Exercise</option>
                </select>
                <select class="filter-select" id="timeframeFilter" onchange="updateDashboard()">
                    <option value="7">Last 7 Days</option>
                    <option value="14">Last 2 Weeks</option>
                    <option value="30" selected>Last Month</option>
                    <option value="90">Last 3 Months</option>
                    <option value="180">Last 6 Months</option>
                    <option value="365">Last Year</option>
                    <option value="all">All Time</option>
                </select>
            </div>

            <div class="bento-grid">
                <!-- Main Progress Chart -->
                <div class="bento-item bento-large">
                    <div class="bento-title">üìà Weight Progression</div>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>

                <!-- Total Workouts -->
                <div class="bento-item">
                    <div class="bento-title">üèãÔ∏è Total Workouts</div>
                    <div class="stat-value" id="totalWorkouts">0</div>
                    <div class="stat-label">Completed Sessions</div>
                    <div class="stat-change stat-up" id="workoutChange">+0 this week</div>
                </div>

                <!-- Current Streak -->
                <div class="bento-item">
                    <div class="bento-title">üî• Current Streak</div>
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Days in a row</div>
                </div>

                <!-- Volume Chart -->
                <div class="bento-item">
                    <div class="bento-title">üìä Total Volume</div>
                    <div class="chart-container" style="height: 150px;">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>

                <!-- Personal Records -->
                <div class="bento-item">
                    <div class="bento-title">üèÜ Personal Records</div>
                    <div id="personalRecords" style="max-height: 200px; overflow-y: auto;">
                        <div style="opacity: 0.7; text-align: center; padding: 20px;">
                            Complete workouts to see your PRs
                        </div>
                    </div>
                </div>

                <!-- Recent Workouts -->
                <div class="bento-item">
                    <div class="bento-title">üìÖ Recent Workouts</div>
                    <div class="recent-workouts" id="recentWorkouts">
                        <div style="opacity: 0.7; text-align: center; padding: 20px;">
                            No workouts logged yet
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const workouts = {
            posterior: {
                name: "Posterior Day",
                day: "Sunday",
                exercises: [
                    {
                        name: "Pull-Ups",
                        muscles: "Back, biceps, rear shoulders",
                        goal: "Strengthen upper back, improve shoulder blade control",
                        sets: "3 sets",
                        reps: "6-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Hang from bar with hands shoulder-width apart, palms facing away",
                            "Pull shoulder blades down and back, then pull chest toward bar",
                            "Lower with control until arms are fully extended"
                        ],
                        focus: ["Shoulder blades pull down first", "Chest to bar at top", "Full arm extension at bottom"],
                        avoid: ["Swinging body", "Shrugging shoulders up", "Partial reps"]
                    },
                    {
                        name: "Barbell/Dumbbell Rows",
                        muscles: "Upper back, lats, rear shoulders",
                        goal: "Build back thickness, correct rounded shoulders",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Hinge at hips with flat back, knees slightly bent",
                            "Pull weight to lower chest/upper abdomen",
                            "Squeeze shoulder blades together at top, lower with control"
                        ],
                        focus: ["Flat back throughout", "Lead with elbows", "Squeeze shoulder blades"],
                        avoid: ["Rounding lower back", "Using momentum", "Shrugging shoulders"]
                    },
                    {
                        name: "Rear Delt Fly",
                        muscles: "Rear shoulders, upper back",
                        goal: "Balance front-heavy shoulders, improve posture",
                        sets: "3 sets",
                        reps: "12-15 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Hinge forward with dumbbells hanging below chest",
                            "Raise arms out to sides in wide arc",
                            "Squeeze shoulder blades together at top"
                        ],
                        focus: ["Think of pulling elbows back", "Slight bend in elbows", "Control the movement"],
                        avoid: ["Using heavy weight", "Swinging", "Lifting torso up"]
                    },
                    {
                        name: "Romanian Deadlift (RDL)",
                        muscles: "Hamstrings, glutes, lower back",
                        goal: "Strengthen posterior chain, reduce anterior pelvic tilt",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Stand with barbell, feet hip-width, slight knee bend",
                            "Push hips back while lowering bar down shins",
                            "Drive hips forward to return, squeezing glutes at top"
                        ],
                        focus: ["Hips move back, not down", "Feel stretch in hamstrings", "Ribs down, avoid arching"],
                        avoid: ["Rounding back", "Bending knees too much", "Overextending at top"]
                    },
                    {
                        name: "Hip Thrust",
                        muscles: "Glutes, hamstrings",
                        goal: "Reduce anterior pelvic tilt by strengthening glutes",
                        sets: "3 sets",
                        reps: "10-15 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Upper back on bench, feet flat on floor, barbell across hips",
                            "Drive through heels, lifting hips up",
                            "Finish with straight line from shoulders to knees, ribs down"
                        ],
                        focus: ["Glutes squeeze at top", "Slight posterior pelvic tilt", "Straight body line"],
                        avoid: ["Arching lower back", "Pushing through toes", "Hyperextending"]
                    },
                    {
                        name: "Bulgarian Split Squat",
                        muscles: "Quads, glutes, core stability",
                        goal: "Single-leg strength, pelvic stability",
                        sets: "3 sets each leg",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Rear foot elevated on bench, front foot forward",
                            "Lower back knee toward ground, keeping torso upright",
                            "Drive through front heel to return to start"
                        ],
                        focus: ["Torso stays tall", "Front knee tracks over toes", "Control descent"],
                        avoid: ["Leaning too far forward", "Front knee caving in", "Losing balance"]
                    }
                ]
            },
            fullbody: {
                name: "Full Body Day",
                day: "Tuesday",
                exercises: [
                    {
                        name: "Barbell/Goblet Squat",
                        muscles: "Quads, glutes, core",
                        goal: "Full body strength, core stability",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Feet shoulder-width, weight on back/at chest",
                            "Lower hips back and down, keeping chest up",
                            "Drive through full foot to stand, ribs down at top"
                        ],
                        focus: ["Chest stays proud", "Knees track over toes", "Full depth if mobile"],
                        avoid: ["Knees caving inward", "Excessive forward lean", "Arching back at top"]
                    },
                    {
                        name: "Dumbbell Bench Press",
                        muscles: "Chest, front shoulders, triceps",
                        goal: "Balanced upper body strength",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Lie on bench, dumbbells at chest level, shoulder blades squeezed",
                            "Press dumbbells up until arms are straight",
                            "Lower with control to chest level"
                        ],
                        focus: ["Shoulder blades stay back and down", "Elbows at 45¬∞ angle", "Controlled descent"],
                        avoid: ["Flaring elbows out wide", "Bouncing off chest", "Arching excessively"]
                    },
                    {
                        name: "Single-Arm Dumbbell Row",
                        muscles: "Back, lats, core",
                        goal: "Back strength, anti-rotation stability",
                        sets: "3 sets each side",
                        reps: "10-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "One hand and knee on bench, other foot on floor",
                            "Pull dumbbell to hip, keeping torso stable",
                            "Lower with control, avoiding rotation"
                        ],
                        focus: ["Torso stays square", "Pull elbow back and up", "Squeeze at top"],
                        avoid: ["Rotating torso", "Using momentum", "Shrugging shoulder"]
                    },
                    {
                        name: "Romanian Deadlift (RDL)",
                        muscles: "Hamstrings, glutes, lower back",
                        goal: "Posterior chain strength",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Stand with barbell, feet hip-width, slight knee bend",
                            "Push hips back while lowering bar down shins",
                            "Drive hips forward to return, squeezing glutes at top"
                        ],
                        focus: ["Hips move back, not down", "Feel stretch in hamstrings", "Ribs down, avoid arching"],
                        avoid: ["Rounding back", "Bending knees too much", "Overextending at top"]
                    },
                    {
                        name: "Overhead Press",
                        muscles: "Shoulders, triceps, core",
                        goal: "Shoulder strength with core stability",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Stand with barbell at shoulder height, core braced",
                            "Press weight directly overhead",
                            "Lower with control to shoulders, ribs down throughout"
                        ],
                        focus: ["Ribs stay down", "Core tight", "Press straight up"],
                        avoid: ["Arching back", "Leaning back", "Flaring ribs"]
                    },
                    {
                        name: "Plank Variations",
                        muscles: "Core, shoulders, stabilizers",
                        goal: "Core stability, prevent anterior pelvic tilt",
                        sets: "3 sets",
                        reps: "30-60 seconds",
                        currentWeight: 0,
                        weightUnit: "bodyweight",
                        steps: [
                            "Forearms on ground, body in straight line",
                            "Brace core, tuck pelvis slightly",
                            "Hold position without sagging or piking"
                        ],
                        focus: ["Squeeze glutes", "Ribs pulled down", "Neutral spine"],
                        avoid: ["Sagging hips", "Piking hips up", "Holding breath"]
                    }
                ]
            },
            anterior: {
                name: "Anterior Day",
                day: "Friday",
                exercises: [
                    {
                        name: "Dumbbell Bench Press",
                        muscles: "Chest, front shoulders, triceps",
                        goal: "Chest strength with scapular control",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Lie on bench, dumbbells at chest level, shoulder blades squeezed",
                            "Press dumbbells up until arms are straight",
                            "Lower with control to chest level"
                        ],
                        focus: ["Shoulder blades stay back and down", "Elbows at 45¬∞ angle", "Controlled descent"],
                        avoid: ["Flaring elbows out wide", "Bouncing off chest", "Arching excessively"]
                    },
                    {
                        name: "Incline Dumbbell Press",
                        muscles: "Upper chest, front shoulders",
                        goal: "Upper chest development, shoulder health",
                        sets: "3 sets",
                        reps: "8-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Bench at 30-45¬∞ angle, dumbbells at upper chest",
                            "Press dumbbells up and slightly together",
                            "Lower to upper chest level with control"
                        ],
                        focus: ["Keep shoulder blades retracted", "Press up and in", "Stable shoulder position"],
                        avoid: ["Excessive arch", "Elbows flaring", "Momentum"]
                    },
                    {
                        name: "Lateral Raises",
                        muscles: "Side shoulders",
                        goal: "Shoulder development, balanced strength",
                        sets: "3 sets",
                        reps: "12-15 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Stand with dumbbells at sides, slight forward lean",
                            "Raise arms out to sides to shoulder height",
                            "Lower with control, maintaining tension"
                        ],
                        focus: ["Lead with elbows", "Stop at shoulder height", "Control the descent"],
                        avoid: ["Using momentum", "Raising too high", "Shrugging shoulders"]
                    },
                    {
                        name: "Incline Dumbbell Curl",
                        muscles: "Biceps",
                        goal: "Bicep development with shoulder stretch",
                        sets: "3 sets",
                        reps: "10-12 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Sit on incline bench, arms hanging straight down",
                            "Curl dumbbells up, keeping elbows back",
                            "Lower with control to full extension"
                        ],
                        focus: ["Keep elbows back", "Full range of motion", "Squeeze at top"],
                        avoid: ["Swinging", "Moving elbows forward", "Partial reps"]
                    },
                    {
                        name: "Tricep Dips or Extensions",
                        muscles: "Triceps, chest",
                        goal: "Arm development, pressing strength",
                        sets: "3 sets",
                        reps: "10-15 reps",
                        currentWeight: 0,
                        weightUnit: "kg",
                        steps: [
                            "Hands on bench or bars, body supported",
                            "Lower body by bending elbows to 90¬∞",
                            "Press back up to straight arms"
                        ],
                        focus: ["Shoulders stay down", "Controlled movement", "Full extension"],
                        avoid: ["Shrugging shoulders", "Going too deep", "Leaning too far forward"]
                    },
                    {
                        name: "Hanging Leg Raises",
                        muscles: "Lower abs, hip flexors",
                        goal: "Core strength, pelvic control",
                        sets: "3 sets",
                        reps: "10-15 reps",
                        currentWeight: 0,
                        weightUnit: "bodyweight",
                        steps: [
                            "Hang from bar with straight arms",
                            "Tuck pelvis and raise knees toward chest",
                            "Lower with control, avoiding swing"
                        ],
                        focus: ["Tuck pelvis first", "Controlled movement", "Prevent swinging"],
                        avoid: ["Using momentum", "Swinging legs", "Arching back"]
                    }
                ]
            }
        };

        let currentWorkout = null;
        let currentExerciseIndex = 0;
        let isEditMode = false;
        let currentImageIndex = 0;
        let exerciseImages = {};
        let workoutHistory = JSON.parse(localStorage.getItem('workoutHistory')) || [];
        let currentWorkoutData = [];
        let progressChart = null;
        let volumeChart = null;

        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => console.log('SW registered:', registration))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }

        // Initialize image storage
        function initializeImageStorage() {
            Object.keys(workouts).forEach(workoutKey => {
                workouts[workoutKey].exercises.forEach((exercise, index) => {
                    const key = `${workoutKey}-${index}`;
                    if (!exerciseImages[key]) {
                        exerciseImages[key] = [];
                    }
                });
            });
            
            // Load from localStorage
            const savedImages = localStorage.getItem('exerciseImages');
            if (savedImages) {
                exerciseImages = JSON.parse(savedImages);
            }
        }

        function saveImages() {
            localStorage.setItem('exerciseImages', JSON.stringify(exerciseImages));
        }

        initializeImageStorage();

        // Section navigation
        function showSection(section) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (section === 'workout') {
                document.getElementById('workoutSection').style.display = 'block';
                document.getElementById('dashboardSection').classList.remove('active');
            } else if (section === 'dashboard') {
                document.getElementById('workoutSection').style.display = 'none';
                document.getElementById('dashboardSection').classList.add('active');
                initializeDashboard();
            }
        }

        // Workout selection
        document.getElementById('workoutSelector').addEventListener('click', (e) => {
            if (e.target.classList.contains('workout-btn')) {
                const workoutType = e.target.dataset.workout;
                selectWorkout(workoutType);
            }
        });

        function selectWorkout(type) {
            currentWorkout = workouts[type];
            currentExerciseIndex = 0;
            currentWorkoutData = [];
            
            document.querySelectorAll('.workout-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.getElementById('workoutContent').style.display = 'block';
            displayExercise();
        }

        function displayExercise() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            const total = currentWorkout.exercises.length;
            const workoutKey = Object.keys(workouts).find(key => workouts[key] === currentWorkout);
            const imageKey = `${workoutKey}-${currentExerciseIndex}`;
            currentImageIndex = 0;
            
            const progress = ((currentExerciseIndex + 1) / total) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `Exercise ${currentExerciseIndex + 1} of ${total}`;
            
            const card = document.getElementById('exerciseCard');
            
            if (currentExerciseIndex >= total) {
                // Save workout and show completion
                saveWorkout();
                card.innerHTML = `
                    <div class="completion-card">
                        <div class="completion-icon">üéâ</div>
                        <h2>Workout Complete!</h2>
                        <p>Great job on completing ${currentWorkout.name}</p>
                        <p style="font-size: 1em; opacity: 0.8;">Your progress has been saved to the dashboard</p>
                        <button class="control-btn btn-next" onclick="resetWorkout()">Start New Workout</button>
                    </div>
                `;
                document.getElementById('prevBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'none';
                return;
            }

            const images = exerciseImages[imageKey] || [];
            const hasImages = images.length > 0;
            
            card.innerHTML = `
                <div class="exercise-header">
                    <button class="edit-btn" onclick="toggleEditMode()">‚úèÔ∏è Edit</button>
                    <div class="exercise-name" id="exerciseName">${exercise.name}</div>
                    <div class="exercise-meta">
                        <span class="meta-item" id="exerciseMuscles">üí™ ${exercise.muscles}</span>
                        <span class="meta-item" id="exerciseSets">üìä ${exercise.sets}</span>
                        <span class="meta-item" id="exerciseReps">üî¢ ${exercise.reps}</span>
                    </div>
                    <div class="weight-input-container">
                        <label style="font-size: 0.95em; opacity: 0.9;">Weight:</label>
                        <input type="number" 
                               id="currentWeight" 
                               class="editable-input" 
                               placeholder="0" 
                               value="${exercise.currentWeight || ''}"
                               onchange="updateCurrentWeight(this.value)"
                               style="width: 100px; padding: 8px; text-align: center;">
                        <select id="weightUnit" class="editable-input" style="width: 80px; padding: 8px;" onchange="updateWeightUnit(this.value)">
                            <option value="kg" ${exercise.weightUnit === 'kg' ? 'selected' : ''}>kg</option>
                            <option value="lbs" ${exercise.weightUnit === 'lbs' ? 'selected' : ''}>lbs</option>
                        </select>
                    </div>
                </div>

                <div class="exercise-image">
                    ${hasImages ? `
                        <div class="image-gallery">
                            ${images.map((img, i) => `
                                <img src="${img}" class="gallery-image ${i === 0 ? 'active' : ''}" alt="Exercise step ${i + 1}">
                            `).join('')}
                            <button class="gallery-arrow left" onclick="previousImage()" ${images.length <= 1 ? 'disabled' : ''}>‚Üê</button>
                            <button class="gallery-arrow right" onclick="nextImage()" ${images.length <= 1 ? 'disabled' : ''}>‚Üí</button>
                            ${images.length > 1 ? `<div class="image-counter">${currentImageIndex + 1} / ${images.length}</div>` : ''}
                        </div>
                    ` : `
                        <div class="upload-zone" onclick="document.getElementById('imageUpload').click()">
                            <div class="placeholder-icon">üèãÔ∏è</div>
                            <button class="upload-btn">üì∑ Upload Exercise Images</button>
                            <p style="opacity: 0.7; font-size: 0.9em;">Click to add form reference photos</p>
                        </div>
                    `}
                    <input type="file" id="imageUpload" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
                </div>

                ${hasImages ? `
                    <div class="thumbnail-container">
                        ${images.map((img, i) => `
                            <div class="thumbnail-wrapper">
                                <img src="${img}" class="image-thumbnail ${i === 0 ? 'active' : ''}" onclick="jumpToImage(${i})" alt="Thumbnail ${i + 1}">
                                <button class="delete-image-btn" onclick="deleteImage(${i}, event)">√ó</button>
                            </div>
                        `).join('')}
                        <button class="upload-btn" onclick="document.getElementById('imageUpload').click()" style="width: 80px; height: 80px; padding: 0;">+</button>
                    </div>
                ` : ''}

                <div class="exercise-details">
                    <div class="detail-section">
                        <div class="detail-title">üéØ Goal</div>
                        <div class="detail-content" id="exerciseGoal">${exercise.goal}</div>
                    </div>

                    <div class="detail-section">
                        <div class="detail-title">üìã How to Perform</div>
                        <div class="detail-content">
                            <ul class="steps-list" id="exerciseSteps">
                                ${exercise.steps.map((step, i) => 
                                    `<li data-step="${i + 1}">${step}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    </div>

                    <div class="detail-section">
                        <div class="detail-title">üí° Key Points</div>
                        <div class="cues-grid">
                            <div id="focusCues">
                                ${exercise.focus.map(item => 
                                    `<div class="cue-box focus-cue">‚úì ${item}</div>`
                                ).join('')}
                            </div>
                            <div id="avoidCues">
                                ${exercise.avoid.map(item => 
                                    `<div class="cue-box avoid-cue">‚úó ${item}</div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('prevBtn').disabled = currentExerciseIndex === 0;
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('prevBtn').style.display = 'flex';
            document.getElementById('nextBtn').style.display = 'flex';
            
            isEditMode = false;
        }

        function updateCurrentWeight(value) {
            currentWorkout.exercises[currentExerciseIndex].currentWeight = parseFloat(value) || 0;
        }

        function updateWeightUnit(value) {
            currentWorkout.exercises[currentExerciseIndex].weightUnit = value;
        }

        // Image gallery functions
        function nextImage() {
            const workoutKey = Object.keys(workouts).find(key => workouts[key] === currentWorkout);
            const imageKey = `${workoutKey}-${currentExerciseIndex}`;
            const images = exerciseImages[imageKey] || [];
            
            if (currentImageIndex < images.length - 1) {
                currentImageIndex++;
                updateGalleryDisplay();
            }
        }

        function previousImage() {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                updateGalleryDisplay();
            }
        }

        function jumpToImage(index) {
            currentImageIndex = index;
            updateGalleryDisplay();
        }

        function updateGalleryDisplay() {
            const galleryImages = document.querySelectorAll('.gallery-image');
            const thumbnails = document.querySelectorAll('.image-thumbnail');
            const counter = document.querySelector('.image-counter');
            
            galleryImages.forEach((img, i) => {
                img.classList.toggle('active', i === currentImageIndex);
            });
            
            thumbnails.forEach((thumb, i) => {
                thumb.classList.toggle('active', i === currentImageIndex);
            });
            
            if (counter) {
                counter.textContent = `${currentImageIndex + 1} / ${galleryImages.length}`;
            }
        }

        function handleImageUpload(event) {
            const files = event.target.files;
            const workoutKey = Object.keys(workouts).find(key => workouts[key] === currentWorkout);
            const imageKey = `${workoutKey}-${currentExerciseIndex}`;
            
            if (!exerciseImages[imageKey]) {
                exerciseImages[imageKey] = [];
            }
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    exerciseImages[imageKey].push(e.target.result);
                    saveImages();
                    displayExercise();
                };
                reader.readAsDataURL(file);
            });
            
            event.target.value = '';
        }

        function deleteImage(index, event) {
            event.stopPropagation();
            const workoutKey = Object.keys(workouts).find(key => workouts[key] === currentWorkout);
            const imageKey = `${workoutKey}-${currentExerciseIndex}`;
            
            if (confirm('Delete this image?')) {
                exerciseImages[imageKey].splice(index, 1);
                currentImageIndex = Math.max(0, Math.min(currentImageIndex, exerciseImages[imageKey].length - 1));
                saveImages();
                displayExercise();
            }
        }

        // Edit mode functions
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editBtn = document.querySelector('.edit-btn');
            
            if (isEditMode) {
                editBtn.classList.add('active');
                editBtn.innerHTML = 'üíæ Save';
                enterEditMode();
            } else {
                editBtn.classList.remove('active');
                editBtn.innerHTML = '‚úèÔ∏è Edit';
                saveChanges();
            }
        }

        function enterEditMode() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            
            document.getElementById('exerciseName').innerHTML = `<input type="text" class="editable-input" value="${exercise.name}" id="editName">`;
            document.getElementById('exerciseMuscles').innerHTML = `üí™ <input type="text" class="editable-input" value="${exercise.muscles}" id="editMuscles" style="width: 200px; display: inline-block;">`;
            document.getElementById('exerciseSets').innerHTML = `üìä <input type="text" class="editable-input" value="${exercise.sets}" id="editSets" style="width: 100px; display: inline-block;">`;
            document.getElementById('exerciseReps').innerHTML = `üî¢ <input type="text" class="editable-input" value="${exercise.reps}" id="editReps" style="width: 100px; display: inline-block;">`;
            document.getElementById('exerciseGoal').innerHTML = `<textarea class="editable-input" id="editGoal">${exercise.goal}</textarea>`;
            
            document.getElementById('exerciseSteps').innerHTML = `
                <ul class="editable-list" id="editSteps">
                    ${exercise.steps.map((step, i) => `
                        <li class="editable-list-item">
                            <input type="text" class="editable-input" value="${step}" data-step="${i}">
                            <button class="remove-btn" onclick="removeStep(${i})">üóëÔ∏è</button>
                        </li>
                    `).join('')}
                </ul>
                <button class="add-btn" onclick="addStep()">+ Add Step</button>
            `;
            
            document.getElementById('focusCues').innerHTML = `
                <div class="editable-list" id="editFocus">
                    ${exercise.focus.map((item, i) => `
                        <div class="editable-list-item" style="margin-bottom: 8px;">
                            <input type="text" class="editable-input" value="${item}" data-focus="${i}">
                            <button class="remove-btn" onclick="removeFocus(${i})">üóëÔ∏è</button>
                        </div>
                    `).join('')}
                </div>
                <button class="add-btn" onclick="addFocus()">+ Add Focus Point</button>
            `;
            
            document.getElementById('avoidCues').innerHTML = `
                <div class="editable-list" id="editAvoid">
                    ${exercise.avoid.map((item, i) => `
                        <div class="editable-list-item" style="margin-bottom: 8px;">
                            <input type="text" class="editable-input" value="${item}" data-avoid="${i}">
                            <button class="remove-btn" onclick="removeAvoid(${i})">üóëÔ∏è</button>
                        </div>
                    `).join('')}
                </div>
                <button class="add-btn" onclick="addAvoid()">+ Add Avoid Point</button>
            `;
        }

        function saveChanges() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            
            exercise.name = document.getElementById('editName')?.value || exercise.name;
            exercise.muscles = document.getElementById('editMuscles')?.value || exercise.muscles;
            exercise.sets = document.getElementById('editSets')?.value || exercise.sets;
            exercise.reps = document.getElementById('editReps')?.value || exercise.reps;
            exercise.goal = document.getElementById('editGoal')?.value || exercise.goal;
            
            const stepInputs = document.querySelectorAll('#editSteps input');
            if (stepInputs.length > 0) {
                exercise.steps = Array.from(stepInputs).map(input => input.value);
            }
            
            const focusInputs = document.querySelectorAll('#editFocus input');
            if (focusInputs.length > 0) {
                exercise.focus = Array.from(focusInputs).map(input => input.value);
            }
            
            const avoidInputs = document.querySelectorAll('#editAvoid input');
            if (avoidInputs.length > 0) {
                exercise.avoid = Array.from(avoidInputs).map(input => input.value);
            }
            
            displayExercise();
        }

        function addStep() {
            const container = document.getElementById('editSteps');
            const newIndex = container.querySelectorAll('input').length;
            const li = document.createElement('li');
            li.className = 'editable-list-item';
            li.innerHTML = `
                <input type="text" class="editable-input" placeholder="New step" data-step="${newIndex}">
                <button class="remove-btn" onclick="removeStep(${newIndex})">üóëÔ∏è</button>
            `;
            container.appendChild(li);
        }

        function removeStep(index) {
            const input = document.querySelector(`#editSteps input[data-step="${index}"]`);
            if (input) input.closest('.editable-list-item').remove();
        }

        function addFocus() {
            const container = document.getElementById('editFocus');
            const newIndex = container.querySelectorAll('input').length;
            const div = document.createElement('div');
            div.className = 'editable-list-item';
            div.style.marginBottom = '8px';
            div.innerHTML = `
                <input type="text" class="editable-input" placeholder="New focus point" data-focus="${newIndex}">
                <button class="remove-btn" onclick="removeFocus(${newIndex})">üóëÔ∏è</button>
            `;
            container.appendChild(div);
        }

        function removeFocus(index) {
            const input = document.querySelector(`#editFocus input[data-focus="${index}"]`);
            if (input) input.closest('.editable-list-item').remove();
        }

        function addAvoid() {
            const container = document.getElementById('editAvoid');
            const newIndex = container.querySelectorAll('input').length;
            const div = document.createElement('div');
            div.className = 'editable-list-item';
            div.style.marginBottom = '8px';
            div.innerHTML = `
                <input type="text" class="editable-input" placeholder="New avoid point" data-avoid="${newIndex}">
                <button class="remove-btn" onclick="removeAvoid(${newIndex})">üóëÔ∏è</button>
            `;
            container.appendChild(div);
        }

        function removeAvoid(index) {
            const input = document.querySelector(`#editAvoid input[data-avoid="${index}"]`);
            if (input) input.closest('.editable-list-item').remove();
        }

        // Navigation
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentExerciseIndex > 0) {
                // Save current exercise data before moving
                if (currentWorkout) {
                    const exercise = currentWorkout.exercises[currentExerciseIndex];
                    currentWorkoutData[currentExerciseIndex] = {
                        name: exercise.name,
                        weight: exercise.currentWeight || 0,
                        unit: exercise.weightUnit || 'kg',
                        sets: exercise.sets,
                        reps: exercise.reps
                    };
                }
                currentExerciseIndex--;
                displayExercise();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            // Save current exercise data
            if (currentWorkout) {
                const exercise = currentWorkout.exercises[currentExerciseIndex];
                currentWorkoutData[currentExerciseIndex] = {
                    name: exercise.name,
                    weight: exercise.currentWeight || 0,
                    unit: exercise.weightUnit || 'kg',
                    sets: exercise.sets,
                    reps: exercise.reps
                };
            }
            currentExerciseIndex++;
            displayExercise();
        });

        function resetWorkout() {
            document.getElementById('workoutContent').style.display = 'none';
            document.querySelectorAll('.workout-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            currentWorkout = null;
            currentExerciseIndex = 0;
            currentWorkoutData = [];
        }

        // Save workout to history
        function saveWorkout() {
            if (!currentWorkout || currentWorkoutData.length === 0) return;
            
            const workoutKey = Object.keys(workouts).find(key => workouts[key] === currentWorkout);
            
            const workout = {
                date: new Date().toISOString(),
                name: currentWorkout.name,
                day: currentWorkout.day,
                workoutType: workoutKey,
                exercises: currentWorkoutData.filter(e => e !== undefined)
            };
            
            workoutHistory.push(workout);
            localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));
        }

        // Dashboard functions
        function initializeDashboard() {
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                setTimeout(initializeDashboard, 100); // Retry after 100ms
                return;
            }
            
            populateExerciseFilter();
            updateDashboard();
        }

        function populateExerciseFilter() {
            const filter = document.getElementById('exerciseFilter');
            const exercises = new Set();
            
            Object.values(workouts).forEach(workout => {
                workout.exercises.forEach(ex => exercises.add(ex.name));
            });
            
            filter.innerHTML = '<option value="">All Exercises</option>' +
                Array.from(exercises).sort().map(name => 
                    `<option value="${name}">${name}</option>`
                ).join('');
        }

        function updateDashboard() {
            const selectedExercise = document.getElementById('exerciseFilter').value;
            const timeframe = document.getElementById('timeframeFilter').value;
            
            const now = new Date();
            const filteredHistory = workoutHistory.filter(w => {
                const workoutDate = new Date(w.date);
                const daysDiff = (now - workoutDate) / (1000 * 60 * 60 * 24);
                return timeframe === 'all' || daysDiff <= parseInt(timeframe);
            });
            
            updateStats(filteredHistory);
            updateProgressChart(filteredHistory, selectedExercise);
            updateVolumeChart(filteredHistory);
            updatePersonalRecords(filteredHistory);
            updateRecentWorkouts(filteredHistory);
        }

        function updateStats(history) {
            // Total workouts
            document.getElementById('totalWorkouts').textContent = history.length;
            
            // Workout change this week
            const now = new Date();
            const oneWeekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
            const thisWeek = history.filter(w => new Date(w.date) >= oneWeekAgo).length;
            const twoWeeksAgo = new Date(now - 14 * 24 * 60 * 60 * 1000);
            const lastWeek = history.filter(w => {
                const date = new Date(w.date);
                return date >= twoWeeksAgo && date < oneWeekAgo;
            }).length;
            
            const change = thisWeek - lastWeek;
            const changeEl = document.getElementById('workoutChange');
            changeEl.textContent = `${change >= 0 ? '+' : ''}${change} this week`;
            changeEl.className = `stat-change ${change >= 0 ? 'stat-up' : 'stat-down'}`;
            
            // Current streak
            let streak = 0;
            const sortedDates = history.map(w => new Date(w.date).toDateString()).reverse();
            const uniqueDates = [...new Set(sortedDates)];
            const today = new Date().toDateString();
            
            for (let i = 0; i < uniqueDates.length; i++) {
                const date = new Date(uniqueDates[i]);
                const expectedDate = new Date(now - i * 24 * 60 * 60 * 1000).toDateString();
                
                if (date.toDateString() === expectedDate) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('currentStreak').textContent = streak;
        }

        function updateProgressChart(history, selectedExercise) {
            const ctx = document.getElementById('progressChart');
            if (!ctx) return;
            
            try {
                // Filter data for selected exercise
                const exerciseData = [];
                history.forEach(workout => {
                    workout.exercises.forEach(ex => {
                        if (!selectedExercise || ex.name === selectedExercise) {
                            exerciseData.push({
                                date: new Date(workout.date),
                                exercise: ex.name,
                                weight: ex.weight,
                                unit: ex.unit
                            });
                        }
                    });
                });
                
                // Group by exercise
                const groupedData = {};
                exerciseData.forEach(item => {
                    if (!groupedData[item.exercise]) {
                        groupedData[item.exercise] = [];
                    }
                    groupedData[item.exercise].push(item);
                });
                
                // Create datasets
                const datasets = Object.entries(groupedData).map(([exercise, data], index) => {
                    const colors = [
                        '#4ade80', '#60a5fa', '#f472b6', '#fb923c', '#a78bfa',
                        '#fbbf24', '#34d399', '#818cf8', '#f87171', '#facc15'
                    ];
                    
                    return {
                        label: exercise,
                        data: data.map(d => ({ x: d.date, y: d.weight })),
                        borderColor: colors[index % colors.length],
                        backgroundColor: colors[index % colors.length] + '40',
                        tension: 0.3,
                        fill: false
                    };
                });
                
                if (progressChart) {
                    progressChart.destroy();
                }
                
                // If no data, show message
                if (datasets.length === 0 || datasets.every(d => d.data.length === 0)) {
                    ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                    const parent = ctx.parentElement;
                    parent.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; opacity: 0.7;">Complete workouts to see your progress</div>';
                    return;
                }
                
                progressChart = new Chart(ctx, {
                    type: 'line',
                    data: { datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: 'white' }
                            }
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: { 
                                    unit: 'day',
                                    displayFormats: {
                                        day: 'MMM d'
                                    }
                                },
                                ticks: { color: 'rgba(255,255,255,0.8)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: { color: 'rgba(255,255,255,0.8)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating progress chart:', error);
                ctx.parentElement.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; opacity: 0.7;">Error loading chart</div>';
            }
        }

        function updateVolumeChart(history) {
            const ctx = document.getElementById('volumeChart');
            if (!ctx) return;
            
            try {
                // Calculate weekly volume
                const weeklyVolume = {};
                history.forEach(workout => {
                    const week = getWeekKey(new Date(workout.date));
                    if (!weeklyVolume[week]) weeklyVolume[week] = 0;
                    
                    workout.exercises.forEach(ex => {
                        const sets = parseInt(ex.sets) || 3;
                        const reps = parseInt(ex.reps) || 10;
                        const weight = ex.weight || 0;
                        weeklyVolume[week] += sets * reps * weight;
                    });
                });
                
                const labels = Object.keys(weeklyVolume).sort();
                const data = labels.map(week => weeklyVolume[week]);
                
                if (volumeChart) {
                    volumeChart.destroy();
                }
                
                // If no data, show message
                if (labels.length === 0) {
                    const parent = ctx.parentElement;
                    parent.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; opacity: 0.7;">Complete workouts to see volume</div>';
                    return;
                }
                
                volumeChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels.map(w => {
                            const parts = w.split('-W');
                            return `W${parts[1]}`;
                        }),
                        datasets: [{
                            label: 'Volume (kg)',
                            data: data,
                            backgroundColor: 'rgba(74, 222, 128, 0.6)',
                            borderColor: '#4ade80',
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: {
                                ticks: { color: 'rgba(255,255,255,0.8)' },
                                grid: { display: false }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: { color: 'rgba(255,255,255,0.8)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating volume chart:', error);
                ctx.parentElement.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; opacity: 0.7;">Error loading chart</div>';
            }
        }

        function getWeekKey(date) {
            const year = date.getFullYear();
            const week = Math.ceil((((date - new Date(year, 0, 1)) / 86400000) + new Date(year, 0, 1).getDay() + 1) / 7);
            return `${year}-W${week}`;
        }

        function updatePersonalRecords(history) {
            const prs = {};
            
            history.forEach(workout => {
                workout.exercises.forEach(ex => {
                    if (!prs[ex.name] || ex.weight > prs[ex.name].weight) {
                        prs[ex.name] = {
                            weight: ex.weight,
                            unit: ex.unit,
                            date: workout.date
                        };
                    }
                });
            });
            
            const container = document.getElementById('personalRecords');
            
            if (Object.keys(prs).length === 0) {
                container.innerHTML = '<div style="opacity: 0.7; text-align: center; padding: 20px;">Complete workouts to see your PRs</div>';
                return;
            }
            
            container.innerHTML = Object.entries(prs)
                .sort((a, b) => b[1].weight - a[1].weight)
                .slice(0, 5)
                .map(([exercise, pr]) => `
                    <div class="workout-entry">
                        <div>
                            <div style="font-weight: 600; font-size: 0.95em;">${exercise}</div>
                            <div style="opacity: 0.7; font-size: 0.85em;">${new Date(pr.date).toLocaleDateString()}</div>
                        </div>
                        <div style="font-size: 1.2em; font-weight: 700;">${pr.weight} ${pr.unit}</div>
                    </div>
                `).join('');
        }

        function updateRecentWorkouts(history) {
            const container = document.getElementById('recentWorkouts');
            
            if (history.length === 0) {
                container.innerHTML = '<div style="opacity: 0.7; text-align: center; padding: 20px;">No workouts logged yet</div>';
                return;
            }
            
            container.innerHTML = history
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5)
                .map(workout => `
                    <div class="workout-entry">
                        <div>
                            <div class="workout-name">${workout.name}</div>
                            <div class="workout-date">${new Date(workout.date).toLocaleDateString()} ‚Ä¢ ${workout.exercises.length} exercises</div>
                        </div>
                        <div style="opacity: 0.8;">${workout.day}</div>
                    </div>
                `).join('');
        }
    </script>
</body>
</html>
